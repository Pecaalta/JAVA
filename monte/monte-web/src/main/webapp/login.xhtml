<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:f="http://xmlns.jcp.org/jsf/core">
    <h:head>
        <title>Login</title>
        <link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet"></link>
        <meta name="google-signin-client_id" content="41773803941-p9l0sms3ggnmto9rj2qphfcukfufj4bo.apps.googleusercontent.com"/>
        <script src="https://apis.google.com/js/platform.js" async="async" defer="defer"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.0/jquery.min.js"></script>
        <style>
            .ui-link {
                padding: 0.5rem 0.8rem;
                display: inline-block;
            }
        </style>
    </h:head>
    <h:body>
        <h:form>
            <p:growl showDetail="true"/>
            <h:panelGrid columns="2">
            <p:outputLabel for="txtEmail" value="Email"/>
            <p:inputText id="txtEmail" value="#{UsuarioController.cliente.email}" autocomplete="off" required="true" widgetVar="textoEmail" />
            
            <p:outputLabel for="txtPassword" value="Password"/>
            
            <p:password id="txtPassword" value="#{UsuarioController.cliente.password}" promptLabel="Ingrese una clave" required="true">
                <f:validateLength minimum = "5" maximum = "8" />
            </p:password>
            
            <h:column />
            <p:commandButton icon="ui-icon-key" value="Iniciar sesion" styleClass="ui-priority-primary"  action="#{UsuarioController.iniciarSesion()}"/>
           
            
            </h:panelGrid>
            
            
            <p:link value="Crea una cuenta" outcome="registro" />
            <p:link value="Registrarta tu tienda" outcome="registroTienda" />
            
        </h:form>
        <p:separator />
        <h:form id="goid">
            <div class="g-signin2" data-onsuccess="onSignIn"></div>
            <p:inputText style="display: none" widgetVar="wve" value="#{UsuarioController.cliente.email}" />
            <h:commandButton style="display: none" id="clickButton" action="#{UsuarioController.iniciarSesionGoogle()}"/>
            
            
        </h:form>
        
        <script>
            function onSignIn(googleUser) {
                var profile = googleUser.getBasicProfile();
                var id_token = googleUser.getAuthResponse().id_token;
                console.log('Id token : ' + id_token);
                console.log('Id : ' + profile.getId());
                console.log('Name: ' + profile.getName());
                console.log('Image URL: ' + profile.getImageUrl());
                console.log('Email: ' + profile.getEmail());

                var xhr = new XMLHttpRequest();
                xhr.open('POST', 'http://localhost:8080/monte-web/api/hola/sesionGoogle');
                xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
            //    xhr.onload = function() {
            //      console.log('Signed in as: ' + xhr.responseText);
            //    };
                
                
                
                xhr.send("email=" + profile.getEmail() + 
                        "&amp;nombre=" + profile.getGivenName() + 
                        "&amp;apellido=" + profile.getFamilyName());
                //xhr.send("nombre=" + profile.getGivenName());
                //xhr.send("apellido=" + profile.getFamilyName());


                PF('wve').jq.val(profile.getEmail());

               /* window.onload = function(){
                    var button = document.getElementById('clickButton');
                    button.form.submit();
                    alert("Lo hice wii");
                };*/



                var auth2 = gapi.auth2.getAuthInstance();
                auth2.signOut().then(function () {
                  console.log('User signed out.');
              });  
              fnc();
                //window.location.replace("http://localhost:8080/monte-web/faces/protegido/report.xhtml");

            }

            function fnc()
            {
                $("#goid\\:clickButton").click();
            }
        </script>
    </h:body>
</html>

